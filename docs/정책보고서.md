**[정책] 보안진단 자동화 프로젝트 형상관리 및 운영 가이드**

| 문서 번호 | SCM-2026-001 | 작성 일자 | 2026. 02. 10 |
| :---- | :---- | :---- | :---- |
| **프로젝트명** | AI-SEC-OPS Playbook | **최종 수정** | 2026. 02. 11 |
| **적용 범위** | playbook 모노레포 및 관련 하위 모듈 | **보안 등급** | **대외비 (Internal Only)** |

---

## 1. 개요 (Overview)

본 문서는 보안진단 자동화 프로젝트(playbook)의 효율적인 협업과 데이터 보안을 위한 형상관리 기준을 정의한다.

본 프로젝트는 **개인 작업의 유연성**과 **팀 자산의 보안성**을 동시에 확보하기 위해, **GitHub(개인 워크스페이스)**와 **Bitbucket(팀 공유 자산)**을 분리하여 운영하는 **이원화된 형상관리 정책**을 채택한다.

### 1.1 AI 도구 독립성 (Tool-Agnostic Architecture)

본 프로젝트의 진단 자산(`skills/`, `tools/`)은 **특정 AI 도구에 종속되지 않는 구조**로 설계되어 있다.

| 구성 요소 | 포맷 | AI 도구 독립성 |
| :---- | :---- | :---- |
| 진단 기준 (task_prompts/) | Markdown 텍스트 | 어떤 LLM에도 프롬프트로 전달 가능 |
| 워크플로 (workflow.md) | Markdown 텍스트 | LLM이 읽고 절차 수행 가능 |
| 진단 스키마 (schemas/) | JSON Schema | 표준 포맷, 도구 무관 |
| 탐지 룰 (rules/) | Semgrep YAML / Joern Scala | CLI 도구 기반, AI 무관 |
| 자동화 스크립트 (tools/) | Python | CLI 실행, AI 무관 |

따라서 아래 AI 도구 조합에서 동일한 진단 결과를 재현할 수 있다:

- **Claude Code** — `/sec-audit-static` 스킬 호출로 자동 실행
- **ChatGPT / GPT-4** — task_prompts를 System Prompt로 전달 후 코드 분석 요청
- **Gemini** — 동일 방식으로 프롬프트 전달
- **기타 LLM** — Markdown 프롬프트를 읽을 수 있는 모든 도구에서 사용 가능
- **비-AI 수동 진단** — task_prompts의 진단 기준을 체크리스트로 활용

> **핵심 원칙:** 스크립트(`tools/`)는 터미널에서 직접 실행하고, LLM 분석이 필요한 태스크(2-3~2-5, 교차검증)는 사용자가 선택한 AI 도구에 프롬프트를 전달하여 수행한다.

---

## 2. 형상관리 구조 (Architecture)

전체 프로젝트는 단일 저장소(Monorepo) 구조를 띄지만, 실제 저장 위치는 데이터의 성격에 따라 3가지 영역으로 엄격히 구분된다.

### 2.1 디렉토리 및 저장소 매핑

| 구분 | 디렉토리 경로 | 저장소 위치 | 관리 주체 | 비고 |
| :---- | :---- | :---- | :---- | :---- |
| **워크스페이스** | playbook/ (Root) | **GitHub** (Private) | **개인 (User)** | 개인 작업 환경, 프로젝트 뼈대 |
| **공유 자산 1 (지식)** | skills/ | **Bitbucket** (Team) | **팀 공용** | 진단 기준, 정책, 스키마, 프롬프트, 룰 (Submodule) |
| **공유 자산 2 (도구)** | tools/ | **Bitbucket** (Team) | **팀 공용** | 실행 스크립트, 자동화 도구 (Submodule) |
| **보안/임시 데이터** | state/, testbed/ | **Local Only** | **개인 PC** | **Git Ignore 적용 (저장 금지)** |
| **참조 문서** | docs/ | **GitHub** (Private) | **개인 (User)** | 정책보고서, Wiki 등재용 절차서 |

### 2.2 상세 구조도 (현행)

```
playbook/                          [GitHub: Personal Workspace]
├── CLAUDE.md                      (Claude Code 프로젝트 설정)
├── README.md                      (프로젝트 개요)
│
├── skills/                        [Bitbucket: Team Shared Asset 1] (Submodule)
│   ├── sec-audit-static/          정적 분석 스킬 (Self-Contained)
│   │   ├── SKILL.md               ← 워크플로 정의 + 실행 지침
│   │   └── references/
│   │       ├── task_prompts/      ← 태스크별 진단 프롬프트 (6개)
│   │       ├── schemas/           ← JSON 유효성 검증 스키마
│   │       ├── rules/             ← Semgrep/Joern 커스텀 룰
│   │       │   ├── semgrep/       (7개 YAML 룰)
│   │       │   └── joern/         (2개 Scala 스크립트)
│   │       ├── workflow.md        ← Phase/Task 실행 맵 + 보안 정책
│   │       ├── output_schemas.md  ← JSON 출력 스키마 정의
│   │       ├── severity_criteria.md
│   │       ├── injection_diagnosis_criteria.md
│   │       ├── cross_verification.md
│   │       ├── taint_tracking.md
│   │       ├── global_filters.md
│   │       └── ...                (기타 진단 기준 문서)
│   ├── sec-audit-dast/            동적 분석 스킬
│   ├── external-software-analysis/ 외부 SW 분석 스킬
│   ├── SEVERITY_CRITERIA_DETAIL.md (공통 심각도 기준)
│   └── USAGE_EXAMPLES.md          (사용 예시)
│
├── tools/                         [Bitbucket: Team Shared Asset 2] (Submodule)
│   ├── confluence_page_map.json   (Confluence 페이지 매핑)
│   └── scripts/
│       ├── scan_api.py            API 인벤토리 추출
│       ├── scan_injection_enhanced.py  인젝션 진단 (5-method)
│       ├── scan_injection_patterns.py  패턴 기반 스캔
│       ├── validate_task_output.py     스키마 검증
│       ├── generate_finding_report.py  보고서 생성
│       ├── merge_results.py       결과 병합
│       ├── redact.py              민감정보 마스킹
│       ├── publish_confluence.py  Wiki 게시
│       └── parse_asset_excel.py   Excel 파싱
│
├── docs/                          [GitHub] (정책/절차 문서)
│   ├── 정책보고서.md              ← 본 문서
│   ├── PLAYBOOK_GUIDE.md          (마스터 가이드)
│   └── ...                        (절차서 문서)
│
├── state/                         [Git Ignored] (★ 절대 업로드 금지 ★)
│   └── *.json                     (진단 결과 Raw Data)
│
└── testbed/                       [Git Ignored] (★ 절대 업로드 금지 ★)
    └── <프로젝트명>/              (진단 대상 소스코드)
```

> **참고:** 이전에 존재하던 `workflows/`, `ai/`, `prompts/`, `schemas/` 디렉토리는 모든 내용이 `skills/sec-audit-static/references/` 안으로 통합되어 제거되었다 (2026.02.10).

---

## 3. 진단 실행 절차 (Execution Procedure)

### 3.1 사전 준비

```bash
# 1. playbook repo 클론
git clone <playbook-repo> playbook
cd playbook

# 2. 서브모듈 동기화 (skills + tools)
git submodule update --init --recursive

# 3. 진단 대상 소스코드 배치
mkdir -p testbed/<프로젝트명>
# git clone 또는 파일 복사
```

### 3.2 실행 방법 A — Claude Code (자동)

```bash
claude                    # Claude Code 실행
/sec-audit-static         # 스킬 호출 → 전체 워크플로 자동 실행
```

Claude가 `SKILL.md`를 읽고 Phase 1~4를 순서대로 수행한다.

### 3.3 실행 방법 B — 기타 AI 도구 (반자동)

스크립트 실행은 터미널에서 수동으로, LLM 분석은 선택한 AI 도구에서 수행한다.

**Phase 1: 자산 식별**
```bash
# (선택) 고객 제공 Excel 파싱
python tools/scripts/parse_asset_excel.py --input <excel> --output state/<prefix>_task11.json
```

**Phase 2: 정적 분석**
```bash
# Task 2-1: API 인벤토리 (스크립트)
python tools/scripts/scan_api.py testbed/<프로젝트명>/ \
  -o state/<prefix>_api_inventory.json

# Task 2-2: 인젝션 진단 (스크립트 → AI 검증)
python tools/scripts/scan_injection_enhanced.py testbed/<프로젝트명>/ \
  --api-inventory state/<prefix>_api_inventory.json \
  -o state/<prefix>_task22.json
```

이후 AI 도구에 아래 프롬프트를 전달하여 분석:
- `skills/sec-audit-static/references/task_prompts/task_22_injection_review.md` + 스캔 결과 JSON
- `skills/sec-audit-static/references/task_prompts/task_23_xss_review.md` + 소스코드
- `skills/sec-audit-static/references/task_prompts/task_24_file_handling.md` + 소스코드
- `skills/sec-audit-static/references/task_prompts/task_25_data_protection.md` + 소스코드

**Phase 3: 교차검증**
- `skills/sec-audit-static/references/cross_verification.md`의 5단계 절차에 따라 취약 건 검증
- AI 도구에 해당 기준 + 취약 건 코드를 전달하여 데이터 흐름 추적

**Phase 4: 보고서**
```bash
python tools/scripts/merge_results.py
python tools/scripts/redact.py state/final_report.json
python tools/scripts/validate_task_output.py state/final_report.json
python tools/scripts/generate_finding_report.py --source-label <label>
# (선택) Confluence 게시
python tools/scripts/publish_confluence.py
```

### 3.4 실행 방법 C — 비-AI 수동 진단

스크립트 자동 스캔 결과를 기반으로, `task_prompts/`의 진단 기준을 체크리스트로 활용하여 수동으로 코드 리뷰를 수행한다.

---

## 4. 세부 관리 절차 (Procedures)

### 4.1 핵심 자산(Shared Assets) 관리 : skills/, tools/

이 두 디렉토리는 팀 전체가 공유하는 핵심 자산이므로 **Bitbucket**을 통해 엄격히 관리한다.

1. **동기화:** `git submodule update` 명령어를 통해 항상 최신 팀 버전을 유지한다.
2. **수정 및 배포:**
   - 정책(skills)이나 스크립트(tools) 수정 시, 해당 서브모듈 디렉토리 내에서 별도의 Commit/Push를 수행한다.
   - **Bitbucket Branch:** develop 브랜치에서 작업 후 PR을 통해 main으로 병합한다 (아래 4.4절 참조).
3. **정합성 유지:** skills(지식)에 정의된 진단 기준이 변경되면, tools(스크립트)의 로직도 반드시 함께 업데이트하여 버전을 맞춘다.
4. **Self-Contained 원칙:** `skills/` + `tools/`만으로 진단 재현이 가능해야 한다. 외부 경로(`docs/` 등)에 대한 런타임 의존성을 만들지 않는다.
5. **자동화 도구:** `tools/scripts/push_bitbucket.py` 스크립트를 통해 push 및 PR 생성을 자동화한다.

### 4.4 Bitbucket PR 및 Merge 정책

skills/와 tools/ 변경 사항을 Bitbucket에 반영할 때의 브랜치 전략 및 PR 절차를 정의한다.

#### 4.4.1 브랜치 전략

| 브랜치 | 용도 | 보호 정책 |
| :---- | :---- | :---- |
| **main** | 안정 릴리스 (팀원 동기화 대상) | Direct push 제한, PR을 통해서만 병합 |
| **develop** | 통합 테스트 브랜치 | push_bitbucket.py --pr 로 자동 push |

> **1인 운영 시 예외:** 팀원이 1인인 경우 main 직접 push를 허용한다 (`push_bitbucket.py` 기본 모드).
> 팀원이 2인 이상으로 확대되면 반드시 PR 모드(`--pr`)로 전환한다.

#### 4.4.2 PR 생성 절차

```bash
# 1. skills/ 또는 tools/ 수정 작업 수행 (GitHub main 브랜치에서)
# 2. 자동화 스크립트로 PR 생성
python tools/scripts/push_bitbucket.py --token <TOKEN> --pr \
  --message "feat: 인젝션 진단 기준 추가" \
  --pr-title "인젝션 진단 기준 추가"
```

#### 4.4.3 PR 승인 기준

| 항목 | 기준 |
| :---- | :---- |
| **최소 승인자** | 1인 (팀원 2인 이상 시) |
| **자동 검증** | skills/와 tools/ 외 파일이 포함되지 않았는지 확인 |
| **정합성 확인** | skills 진단 기준 변경 시 tools 스크립트도 함께 수정되었는가? |
| **Self-Contained** | 외부 경로(docs/ 등)에 대한 런타임 의존성이 없는가? |
| **보안 데이터** | state/, testbed/ 내 파일이 절대 포함되지 않았는가? |

#### 4.4.4 Merge 정책

| 항목 | 정책 |
| :---- | :---- |
| **Merge 방식** | Squash Merge 권장 (깔끔한 커밋 히스토리 유지) |
| **Merge 후 브랜치** | develop 브랜치는 유지 (다음 push에서 force update) |
| **Merge 권한** | 프로젝트 Owner 또는 승인된 팀원 |

#### 4.4.5 자동화 스크립트 사용법

```bash
# 직접 main push (1인 운영)
python tools/scripts/push_bitbucket.py --token $BITBUCKET_TOKEN

# PR 모드 (팀 운영)
python tools/scripts/push_bitbucket.py --token $BITBUCKET_TOKEN --pr

# 확인만 (dry-run)
python tools/scripts/push_bitbucket.py --token $BITBUCKET_TOKEN --dry-run

# 환경변수로 토큰 설정 (매번 입력 불필요)
export BITBUCKET_TOKEN="BBDC-xxxxx"
python tools/scripts/push_bitbucket.py --pr
```

> **보안 주의:** 토큰은 환경변수 또는 `.env` 파일로 관리하고, 절대 Git에 커밋하지 않는다.

---

### 4.2 개인 작업 공간(Workspace) 관리

skills와 tools를 제외한 나머지 폴더(`docs/` 등)는 개인의 연구 및 문서 작성을 위한 공간으로 **개인 GitHub**에서 관리한다.

1. **초안 작성:** 새로운 진단 기준이나 프롬프트를 자유롭게 작성하고 테스트한다.
2. **통합:** 테스트가 완료된 내용은 `skills/references/` 내의 적절한 위치로 파일을 복사/이동시킨 후, Bitbucket으로 배포한다.

### 4.3 결과물 및 보안 데이터 관리 : state/, testbed/

고객사 데이터 및 진단 결과는 어떠한 원격 저장소(GitHub, Bitbucket)에도 업로드되어서는 안 된다.

1. **Git Ignore 필수 적용:** `.gitignore` 파일에 `/state/` 및 `/testbed/`가 포함되어 있는지 상시 확인한다.
2. **보고서 작성 프로세스:**
   - 진단 수행 후 `state/` 폴더에 result.json 등의 결과 파일 생성.
   - 해당 JSON 데이터를 기반으로 분석 수행 및 마스킹 처리.
   - 최종 보고서(Docx/PDF 등) 작성.
3. **Wiki 업로드:**
   - 작성된 최종 보고서는 사내 **Wiki(Confluence)**의 해당 프로젝트 페이지에 업로드하여 공유한다.
   - `state/` 내의 Raw Data(JSON)는 보고서 업로드 후 로컬에서 보관하다가 프로젝트 종료 시 파기한다.

---

## 5. 작업자 준수 사항 (Checklist)

| 단계 | 확인 항목 |
| :---- | :---- |
| **작업 전** | - `git pull` (GitHub) 및 `git submodule update` (Bitbucket)로 최신화하였는가? |
| **작업 중** | - testbed에 고객사의 실운영 데이터가 포함되어 있지 않은가? (테스트 데이터 사용 권장) |
| **Commit 시** | - skills와 tools의 수정 사항은 **Bitbucket**으로 Push 하였는가? - 그 외 변경 사항은 **GitHub**으로 Push 하였는가? |
| **종료 시** | - state/ 폴더의 진단 결과 중 중요 정보가 포함된 파일이 원격 저장소에 올라가지 않았는가? - 최종 보고서는 **Wiki**에 정상적으로 등록되었는가? |

---

## [부록 A] .gitignore 설정 예시

```
# 데이터 보안을 위한 필수 설정
/state/*
/testbed/*
!/state/.gitkeep

# 로그 및 임시 파일
*.log
__pycache__/
```

## [부록 B] 디렉토리 변경 이력

| 일자 | 변경 내용 |
| :---- | :---- |
| 2026.02.10 | `workflows/` 제거 → `skills/.../references/workflow.md`로 통합 |
| 2026.02.10 | `ai/` 제거 → 보안 정책을 `skills/.../references/workflow.md`에 포함 |
| 2026.02.10 | `prompts/static/` 제거 → `skills/.../references/task_prompts/`로 복사 완료 |
| 2026.02.10 | `schemas/` 제거 → `skills/.../references/schemas/` + `output_schemas.md`로 이관 |
| 2026.02.10 | `validate_task_output.py` 스키마 경로를 `skills/` 내부로 변경 |
| 2026.02.11 | Bitbucket 저장소 초기 구성 (skills/, tools/ 분리 push) |
| 2026.02.11 | §4.4 PR 및 Merge 정책 추가, `push_bitbucket.py` 자동화 스크립트 추가 |
